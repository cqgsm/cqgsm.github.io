<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>白小菜</title>
  <subtitle>心存感激，所遇即温柔~</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://cqblog.info/"/>
  <updated>2016-07-13T16:53:11.688Z</updated>
  <id>http://cqblog.info/</id>
  
  <author>
    <name>白小菜</name>
    <email>260422909@qq.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>mongodb</title>
    <link href="http://cqblog.info/2016/07/14/mongodb/"/>
    <id>http://cqblog.info/2016/07/14/mongodb/</id>
    <published>2016-07-13T16:37:02.000Z</published>
    <updated>2016-07-13T16:53:11.688Z</updated>
    
    <content type="html">&lt;p&gt;近期学习nodejs做了一个小demo，登录注册，上传图片并且裁剪，发表文章。&lt;br&gt;使用了mongodb，做了一个简单的封装，本来想做互相评论回复，但是发现，使用自己封装的简易DAO层，很难实现，集合与集合之间的关系很难处理，下一步学习mongoose.重构整个功能。&lt;br&gt;还是记录下这个简易的封装&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;#1. 连接数据库&lt;br&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; _connectDB(callback) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    var url = settings.dburl;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    MongoClient.connect(url, &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (err, db) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (err) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            throw Error(err);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        callback(db);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;#2. 插入一条数据&lt;br&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;exports.insertOne = &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (collectionName, json, callback) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _connectDB(&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (db) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        db.collection(collectionName).insertOne(json, &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (err, result) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (err) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                db.close();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; callback(err, null);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            callback(null, result);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            db.close();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;#3. 分页查询&lt;br&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;exports.find = &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (collectionName, json, opts, cb) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (arguments.length === 3) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        //不传入args，就是不分页&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        var callback = opts;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        var args = &amp;#123;&lt;span class=&quot;string&quot;&gt;&#39;itemCount&#39;&lt;/span&gt;: 0, &lt;span class=&quot;string&quot;&gt;&#39;page&#39;&lt;/span&gt;: 0&amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (arguments.length === 4) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        //分页&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        var args = opts;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        var callback = cb;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        //排序&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        var sort = args.sort || &amp;#123;&amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        throw new Error(&lt;span class=&quot;string&quot;&gt;&#39;要3或者4个参数&#39;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    //跳过的条目&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    var skipnumber = args.itemCount * args.page;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    //每次取几条&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    var &lt;span class=&quot;built_in&quot;&gt;limit&lt;/span&gt; = args.itemCount;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _connectDB(&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (db) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        db.collection(collectionName).find(json).limit(&lt;span class=&quot;built_in&quot;&gt;limit&lt;/span&gt;).skip(skipnumber).sort(sort).toArray(&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (err, doc) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (err) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                db.close();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; callback(err, null);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            callback(null, doc);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            db.close();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;#4. 删除数据&lt;br&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;exports.delete = &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (collectionName, json, callback) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _connectDB(&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (db) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        db.collection(collectionName).deleteMany(json, &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (err, result) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (err) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                db.close();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                callback(err, null);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            callback(null, result);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            db.close();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;#5. 更新数据&lt;br&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;exports.updataMany = &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (collectionName, json1, json2, callback) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _connectDB(&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (db) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        db.collection(collectionName).updateMany(&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            json1,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            json2,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (err, result) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (err) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    callback(err, null);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    db.close();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                callback(null, result);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                db.close();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;#6. 统计集合文档个数&lt;br&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;//得到文件个数，前端分页用&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;exports.getAllCount = &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (collectName,callback) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _connectDB(&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (db) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        db.collection(collectName).count(&amp;#123;&amp;#125;).then(&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(count)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            callback(count);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            db.close();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;进军mongoose~~~&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;近期学习nodejs做了一个小demo，登录注册，上传图片并且裁剪，发表文章。&lt;br&gt;使用了mongodb，做了一个简单的封装，本来想做互相评论回复，但是发现，使用自己封装的简易DAO层，很难实现，集合与集合之间的关系很难处理，下一步学习mongoose.重构整个功能。&lt;br&gt;还是记录下这个简易的封装&lt;br&gt;
    
    </summary>
    
      <category term="ndoejs" scheme="http://cqblog.info/categories/ndoejs/"/>
    
    
      <category term="mongodb" scheme="http://cqblog.info/tags/mongodb/"/>
    
  </entry>
  
  <entry>
    <title>javascript简单继承</title>
    <link href="http://cqblog.info/2016/07/02/javascript%E7%AE%80%E5%8D%95%E7%BB%A7%E6%89%BF/"/>
    <id>http://cqblog.info/2016/07/02/javascript简单继承/</id>
    <published>2016-07-02T12:05:37.000Z</published>
    <updated>2016-07-02T16:00:00.132Z</updated>
    
    <content type="html">&lt;p&gt;面向对象中少不了继承，js继承方式多种多样，各有优劣，今天来分析使用下John Resig大神的Simple JavaScript Inheritance&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;代码不多，但是很巧妙，非常值得学习&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;58&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;59&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;60&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;61&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;62&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;63&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;65&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;66&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;67&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;68&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;69&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;70&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;71&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;72&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;73&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;74&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;75&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;76&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;77&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;78&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;79&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;80&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;81&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;82&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;83&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;84&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;85&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;86&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;87&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;88&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;89&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;90&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;91&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;92&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;93&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;    /* Simple JavaScript Inheritance&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     * By John Resig http://ejohn.org/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     * MIT Licensed.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     * Inspired by base2 and Prototype&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     */&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;function&lt;/span&gt;&lt;/span&gt;() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    //initializing 用来控制init是在 new Class()的时候触发&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    // /xyz/.test(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;function&lt;/span&gt;&lt;/span&gt;() &amp;#123;xyz;&amp;#125;)用来判定函数的toString是否能暴露里面的实现，也就是把函数变成一个字符串，现代浏览器基本都能正确显示&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    //返回 `_super_` 下面会做判断用&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    var initializing = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        fnTest = /xyz/.test(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;function&lt;/span&gt;&lt;/span&gt;() &amp;#123;xyz;&amp;#125;) ? /\b_super\b/ : /.*/;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    //this是window,暴露到全局，这个是基类&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    this.Class = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;function&lt;/span&gt;&lt;/span&gt;() &amp;#123;&amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    Class.extend = &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(prop) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        //保存父类的原型对象到`_super`&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        var _super = this.prototype;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        //&lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt; 阻止了new this()的时候，立马执行类的init函数&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        initializing = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        //变量prototype保存了父类的`实例化对象`&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        // prototype 继承 _super&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        var prototype = new this(); &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        initializing = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        //复制属性&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (var name &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; prop) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            //传进来的对象遍历，赋给`prototype`这个对象&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            //这段就是为了判断传进来的是函数，而且父类的原型对象里面也有这个函数，并且传进来的函数里面有`_super`,那么就做一些小操作，this._super 指向父类原型对象中的同名方法&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            prototype[name] = typeof prop[name] == &lt;span class=&quot;string&quot;&gt;&quot;function&quot;&lt;/span&gt; &amp;amp;&amp;amp;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                typeof _super[name] == &lt;span class=&quot;string&quot;&gt;&quot;function&quot;&lt;/span&gt; &amp;amp;&amp;amp; fnTest.test(prop[name]) ?&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                (&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(name, fn) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;function&lt;/span&gt;&lt;/span&gt;() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        var tmp = this._super;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        this._super = _super[name];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        var ret = fn.apply(this, arguments);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        this._super = tmp;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; ret;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;)(name, prop[name]) : prop[name];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        //这是一个 局部函数，弄了个跟全局Class一样的名字，这个不影响，完全可以换一个函数名字&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;Class&lt;/span&gt;&lt;/span&gt;() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            //执行初始化函数，这里就用到了上面的initializing开关&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!initializing &amp;amp;&amp;amp; this.init)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                this.init.apply(this, arguments);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        //var prototype = new this();上面的遍历扩充了方法&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        Class.prototype = prototype;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        Class.prototype.constructor = Class;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        //arguments.callee 代表当前执行的函数，也就是Class.extend(这个是全局的Class)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        //保证能顺序继承下去&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        Class.extend = arguments.callee;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; Class;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;)();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;总结下：所有实现都在构造函数的prototype对象中&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;//   `---&amp;gt;`表示继承&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;继承顺序：class(局部函数).prototype ---&amp;gt;  prototype(该对象为new this(),也就是父类的实例,并且添加了子类自己的方法)---&amp;gt; 继承了 父类.prototype&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;最后&lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; 出去了 class(局部函数);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;使用方法：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    var Person = Class.extend(&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            init: &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(name) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                this.name = name;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            getName: &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;function&lt;/span&gt;&lt;/span&gt;() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; this.name;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            oo:&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;function&lt;/span&gt;&lt;/span&gt;()&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                alert(1)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        // Employee类从Person类继承&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        var Employee = Person.extend(&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            init: &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(name, id) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                this._super(name);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                this.id = id;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                this.arr = [1,3];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            getEmployeeID: &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;function&lt;/span&gt;&lt;/span&gt;() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; this.x;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            getName: &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;function&lt;/span&gt;&lt;/span&gt;() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                //  调用父类的方法&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;Employee name: &quot;&lt;/span&gt; + this.name;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        var zhang = new Employee(&lt;span class=&quot;string&quot;&gt;&quot;ZhangSan&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;1234&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        console.log(zhang.getName()) //Employee name: ZhangSan;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    Person类，就是组装好&lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt;给我们的Class(局部函数) &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    new Person() 就完成了上面的继承顺序&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    子类和父类方法同名，子类里面this.super()能直接调用父类的方法&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;面向对象中少不了继承，js继承方式多种多样，各有优劣，今天来分析使用下John Resig大神的Simple JavaScript Inheritance&lt;br&gt;
    
    </summary>
    
      <category term="javascript" scheme="http://cqblog.info/categories/javascript/"/>
    
    
      <category term="js知识汇总" scheme="http://cqblog.info/tags/js%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/"/>
    
  </entry>
  
  <entry>
    <title>git服务器代码自动部署</title>
    <link href="http://cqblog.info/2016/07/01/git%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/"/>
    <id>http://cqblog.info/2016/07/01/git服务器代码自动部署/</id>
    <published>2016-07-01T01:05:24.000Z</published>
    <updated>2016-07-01T03:47:26.279Z</updated>
    
    <content type="html">&lt;p&gt;每次本地代码都要手动上传到服务器在部署，对于懒人的我来说简直不能忍，于是折腾了下git自动化部署，期间踩了不少坑，记录一下防止下次遇到。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;服务器版本： ubantu 16.04&lt;/li&gt;
&lt;li&gt;ipaddress：请填上自己服务器地址&lt;/li&gt;
&lt;li&gt;每次操作都要输入密码，需要配置密钥认证，后期再来填坑&lt;/li&gt;
&lt;li&gt;由于是个人项目，所以没有加入权限控制，后期填坑&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;服务器端准备工作&quot;&gt;&lt;a href=&quot;#服务器端准备工作&quot; class=&quot;headerlink&quot; title=&quot;服务器端准备工作&quot;&gt;&lt;/a&gt;服务器端准备工作&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;这些工作都在 &lt;strong&gt;&lt;em&gt;root&lt;/em&gt;&lt;/strong&gt; 或有管理权限的帐号下进行，下面以root为用户，切换到其他用户的时候会提示&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;确保安装了git&lt;/p&gt;
 &lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;apt-get install git&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;为了安全起见，新建一个专门用于代码部署的无特权用户&lt;/p&gt;
 &lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;useradd -m git &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;passwd deployuser  &lt;span class=&quot;comment&quot;&gt;#设置该用户的密码，也可根据喜好配置成免密码登陆&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;新建一个目录作为要部署代码的根目录，如：&lt;/p&gt;
 &lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#以我的项目为例&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; /&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mkdir /workspace/wechat&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;将这个目录的属主和属组都改为上面新建的用户git&lt;/p&gt;
 &lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; /workspace&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;chown -R git:git *&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;切换到部署代码的专用用户&lt;/p&gt;
 &lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;su - git&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;进入项目根目录，初始化为git仓库&lt;/p&gt;
 &lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; /workspace/wechat&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;git init&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;&lt;em&gt;重要配置&lt;/em&gt;&lt;/strong&gt;让仓库接受代码提交&lt;/p&gt;
 &lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;git config receive.denyCurrentBranch ignore&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[可选]  git config core.worktree ~/www&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[可选]  git config --bool receive.denyNonFastForwards &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;  &lt;span class=&quot;comment&quot;&gt;#禁止强制推送&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;至此，一个空的git仓库就在服务器上建好了，仓库的地址为：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;git@ipaddress/workspace/wechat/.git&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&quot;客户端准备&quot;&gt;&lt;a href=&quot;#客户端准备&quot; class=&quot;headerlink&quot; title=&quot;客户端准备&quot;&gt;&lt;/a&gt;客户端准备&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;通过&lt;strong&gt;&lt;em&gt;git clone&lt;/em&gt;&lt;/strong&gt;从远程仓库上将代码获取到本地&lt;/p&gt;
 &lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;git &lt;span class=&quot;built_in&quot;&gt;clone&lt;/span&gt; git@ipaddress:/workspace/webchat/.git&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#执行以上命令后能看到本地多了个文件夹&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#有可能会有以下警告，不用理会，这是因为服务端的仓库是空的&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#warning: You appear to have cloned an empty repository.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;执行：git remote -v 会显示&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    origin  git@ipaddress:/workspace/wechat/.git (fetch)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    origin  git@ipaddress:/workspace/wechat/.git (pubash)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;至此远程仓库已关联上&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;在clone下来的webchat文件下创建一个文件如：a.txt&lt;/p&gt;
 &lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#在当前目录下打开gitbabash&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;git add .&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;git commit -m &lt;span class=&quot;string&quot;&gt;&#39;test&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;git puorigin master&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#显示如下，代表已经push到服务器仓库了&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#Enter passphrase for key &#39;/c/Users/asus-pc/.sbash/id_rsa&#39;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#Counting objects: 3, done.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#Writing objects: 100% (3/3), 194 bytes | 0 bytes/s, done.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#Total 3 (delta 0), reused 0 (delta 0)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#To git@114.112.156.248:/workspace/wechat/.git&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# * [new branch]      master -&amp;gt; master&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&quot;回到服务器端继续配置&quot;&gt;&lt;a href=&quot;#回到服务器端继续配置&quot; class=&quot;headerlink&quot; title=&quot;回到服务器端继续配置&quot;&gt;&lt;/a&gt;回到服务器端继续配置&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;更新服务端 git 仓库状态并检出文件(执行完以下命令后，将看到服务端仓库也有了a.txt)，这是手动更新，太麻烦了，第二步配置自动更新服务器端代码&lt;/p&gt;
 &lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; /workspace/wechat&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;git update-server-info&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;git checkout &lt;span class=&quot;_&quot;&gt;-f&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#或者执行：&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;git checkout branch_name     &lt;span class=&quot;comment&quot;&gt;# 如果pubash的不是master分支&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;设置服务器端更新钩子 &lt;strong&gt;&lt;em&gt;post-update&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
 &lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; /workspace/wechat/.git/hooks&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#新建 post-receive &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;touch post-receive&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;vim post-receive&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#把以下内容复制进去保存&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;built_in&quot;&gt;unset&lt;/span&gt; GIT_DIR&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; ..&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; git checkout &lt;span class=&quot;_&quot;&gt;-f&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;comment&quot;&gt;#这一步很重要，要有写的权限&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; chmod a+x post-receive&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;出于安全考虑，第二步创建的git用户不允许登录bashell，这可以通过编辑/etc/passwd文件完成。找到类似下面的一行：&lt;/p&gt;
 &lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;git:x:1001:1001:,,,:/home/git:/bin/babash&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#修改为&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;git:x:1001:1001:,,,:/home/git:/usr/bin/git-bashell&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#这样，git用户可以正常通过sbash使用git，但无法登录bashell&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;继续本地新建文件，然后&lt;code&gt;git add .&lt;/code&gt; &lt;code&gt;git commit -m &amp;quot;注释&amp;quot;&lt;/code&gt; &lt;code&gt;git puorigin master&lt;/code&gt;  去服务器上查看，服务器自动更新了我提交的内容，至此大功告成。   &lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;每次本地代码都要手动上传到服务器在部署，对于懒人的我来说简直不能忍，于是折腾了下git自动化部署，期间踩了不少坑，记录一下防止下次遇到。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;服务器版本： ubantu 16.04&lt;/li&gt;
&lt;li&gt;ipaddress：请填上自己服务器地址&lt;/li&gt;
&lt;li&gt;每次操作都要输入密码，需要配置密钥认证，后期再来填坑&lt;/li&gt;
&lt;li&gt;由于是个人项目，所以没有加入权限控制，后期填坑
    
    </summary>
    
      <category term="版本控制" scheme="http://cqblog.info/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/"/>
    
    
      <category term="git" scheme="http://cqblog.info/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>多层json对象嵌套的扁平化与去扁平化</title>
    <link href="http://cqblog.info/2016/06/29/javascript/"/>
    <id>http://cqblog.info/2016/06/29/javascript/</id>
    <published>2016-06-29T12:49:07.000Z</published>
    <updated>2016-07-12T14:19:37.290Z</updated>
    
    <content type="html">&lt;p&gt;废话不多说，直接上代码&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;今天遇到一个问题，多重json嵌套，要扁平化，记实下&lt;br&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;//扁平化&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    JSON.flatten = &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(data) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        var result = &amp;#123;&amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; recurse(cur, prop) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (Object(cur) !== cur) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                result[prop] = cur;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (Array.isArray(cur)) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (var i = 0, l = cur.length; i &amp;lt; l; i++)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    recurse(cur[i], prop + &lt;span class=&quot;string&quot;&gt;&quot;[&quot;&lt;/span&gt; + i + &lt;span class=&quot;string&quot;&gt;&quot;]&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (l == 0)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    result[prop] = [];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                var isEmpty = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (var p &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; cur) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    isEmpty = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    recurse(cur[p], prop ? prop + &lt;span class=&quot;string&quot;&gt;&quot;.&quot;&lt;/span&gt; + p : p);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (isEmpty &amp;amp;&amp;amp; prop)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    result[prop] = &amp;#123;&amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        recurse(data, &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; result;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    //去扁平化&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    JSON.unflatten = &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(data) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;use strict&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (Object(data) !== data || Array.isArray(data))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; data;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        var regex = /\.?([^.\[\]]+)|\[(\d+)\]/g,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            resultholder = &amp;#123;&amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (var p &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; data) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            var cur = resultholder,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                prop = &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                m;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (m = regex.exec(p)) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                cur = cur[prop] || (cur[prop] = (m[2] ? [] : &amp;#123;&amp;#125;));&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                prop = m[2] || m[1];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            cur[prop] = data[p];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; resultholder[&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;] || resultholder;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;测试用例：&lt;br&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;var xml = &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        ToUserName: [&lt;span class=&quot;string&quot;&gt;&#39;阿斯顿&#39;&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        FromUserName: [&lt;span class=&quot;string&quot;&gt;&#39;啊实打实的&#39;&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        CreateTime: [&lt;span class=&quot;string&quot;&gt;&#39;hhhh123123123&#39;&lt;/span&gt;, &amp;#123;&lt;span class=&quot;string&quot;&gt;&quot;x&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;aaa&quot;&lt;/span&gt;&amp;#125;,[1, 2, 3, 4]],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        MsgType: [&lt;span class=&quot;string&quot;&gt;&#39;event&#39;&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        Event: [&lt;span class=&quot;string&quot;&gt;&#39;sdf &#39;&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        EventKey: [&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        xx: &lt;span class=&quot;string&quot;&gt;&#39;xx&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;扁平化结果：&lt;br&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    CreateTime[0]: &lt;span class=&quot;string&quot;&gt;&quot;hhhh123123123&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    CreateTime[1].x: &lt;span class=&quot;string&quot;&gt;&quot;aaa&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    CreateTime[2][0]: 1,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    CreateTime[2][1]: 2,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    CreateTime[2][2]: 3,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    CreateTime[2][3]: 4,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    EventKey[0]: &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    Event[0]: &lt;span class=&quot;string&quot;&gt;&quot;sdf &quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    FromUserName[0]: &lt;span class=&quot;string&quot;&gt;&quot;啊实打实的&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    MsgType[0]: &lt;span class=&quot;string&quot;&gt;&quot;event&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ToUserName[0]: &lt;span class=&quot;string&quot;&gt;&quot;阿斯顿&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    xx: &lt;span class=&quot;string&quot;&gt;&quot;xx&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;正好能满足需求&lt;br&gt;使用   &lt;strong&gt;JSON.flatten&lt;/strong&gt; 能还原去扁平化的值，不做演示。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;废话不多说，直接上代码&lt;br&gt;
    
    </summary>
    
      <category term="javascript" scheme="http://cqblog.info/categories/javascript/"/>
    
    
      <category term="json" scheme="http://cqblog.info/tags/json/"/>
    
  </entry>
  
  <entry>
    <title>nodejs微信开发(一)</title>
    <link href="http://cqblog.info/2016/06/29/wechat/"/>
    <id>http://cqblog.info/2016/06/29/wechat/</id>
    <published>2016-06-29T12:49:07.000Z</published>
    <updated>2016-07-01T02:17:24.689Z</updated>
    
    <content type="html">&lt;p&gt;后期来填坑&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;后期来填坑&lt;br&gt;
    
    </summary>
    
      <category term="nodejs" scheme="http://cqblog.info/categories/nodejs/"/>
    
    
      <category term="微信" scheme="http://cqblog.info/tags/%E5%BE%AE%E4%BF%A1/"/>
    
  </entry>
  
</feed>

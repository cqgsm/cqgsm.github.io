<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>白小菜</title>
  <subtitle>心存感激，所遇即温柔~</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://cqblog.info/"/>
  <updated>2016-06-29T13:09:12.875Z</updated>
  <id>http://cqblog.info/</id>
  
  <author>
    <name>白小菜</name>
    <email>260422909@qq.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>多层json对象嵌套的扁平化与去扁平化</title>
    <link href="http://cqblog.info/2016/06/29/javascript/"/>
    <id>http://cqblog.info/2016/06/29/javascript/</id>
    <published>2016-06-29T12:49:07.000Z</published>
    <updated>2016-06-29T13:09:12.875Z</updated>
    
    <content type="html">&lt;h2 id=&quot;今天遇到一个问题，多重json嵌套，要扁平化，弱鸡挣扎了下，找了个解决方案&quot;&gt;&lt;a href=&quot;#今天遇到一个问题，多重json嵌套，要扁平化，弱鸡挣扎了下，找了个解决方案&quot; class=&quot;headerlink&quot; title=&quot;今天遇到一个问题，多重json嵌套，要扁平化，弱鸡挣扎了下，找了个解决方案&quot;&gt;&lt;/a&gt;今天遇到一个问题，多重json嵌套，要扁平化，弱鸡挣扎了下，找了个解决方案&lt;/h2&gt;&lt;p&gt;今天遇到一个问题，多重json嵌套，要扁平化，弱鸡挣扎了下，找了个解决方案&lt;br&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;//扁平化&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    JSON.flatten = &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(data) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        var result = &amp;#123;&amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; recurse(cur, prop) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (Object(cur) !== cur) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                result[prop] = cur;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (Array.isArray(cur)) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (var i = 0, l = cur.length; i &amp;lt; l; i++)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    recurse(cur[i], prop + &lt;span class=&quot;string&quot;&gt;&quot;[&quot;&lt;/span&gt; + i + &lt;span class=&quot;string&quot;&gt;&quot;]&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (l == 0)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    result[prop] = [];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                var isEmpty = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (var p &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; cur) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    isEmpty = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    recurse(cur[p], prop ? prop + &lt;span class=&quot;string&quot;&gt;&quot;.&quot;&lt;/span&gt; + p : p);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (isEmpty &amp;amp;&amp;amp; prop)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    result[prop] = &amp;#123;&amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        recurse(data, &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; result;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    //去扁平化&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    JSON.unflatten = &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(data) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;string&quot;&gt;&quot;use strict&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (Object(data) !== data || Array.isArray(data))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; data;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        var regex = /\.?([^.\[\]]+)|\[(\d+)\]/g,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            resultholder = &amp;#123;&amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (var p &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; data) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            var cur = resultholder,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                prop = &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                m;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (m = regex.exec(p)) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                cur = cur[prop] || (cur[prop] = (m[2] ? [] : &amp;#123;&amp;#125;));&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                prop = m[2] || m[1];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            cur[prop] = data[p];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;return&lt;/span&gt; resultholder[&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;] || resultholder;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;测试用例：&lt;br&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;var xml = &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        ToUserName: [&lt;span class=&quot;string&quot;&gt;&#39;阿斯顿&#39;&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        FromUserName: [&lt;span class=&quot;string&quot;&gt;&#39;啊实打实的&#39;&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        CreateTime: [&lt;span class=&quot;string&quot;&gt;&#39;hhhh123123123&#39;&lt;/span&gt;, &amp;#123;&lt;span class=&quot;string&quot;&gt;&quot;x&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;aaa&quot;&lt;/span&gt;&amp;#125;,[1, 2, 3, 4]],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        MsgType: [&lt;span class=&quot;string&quot;&gt;&#39;event&#39;&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        Event: [&lt;span class=&quot;string&quot;&gt;&#39;sdf &#39;&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        EventKey: [&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        xx: &lt;span class=&quot;string&quot;&gt;&#39;xx&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;扁平化结果：&lt;br&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    CreateTime[0]: &lt;span class=&quot;string&quot;&gt;&quot;hhhh123123123&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    CreateTime[1].x: &lt;span class=&quot;string&quot;&gt;&quot;aaa&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    CreateTime[2][0]: 1,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    CreateTime[2][1]: 2,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    CreateTime[2][2]: 3,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    CreateTime[2][3]: 4,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    EventKey[0]: &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    Event[0]: &lt;span class=&quot;string&quot;&gt;&quot;sdf &quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    FromUserName[0]: &lt;span class=&quot;string&quot;&gt;&quot;啊实打实的&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    MsgType[0]: &lt;span class=&quot;string&quot;&gt;&quot;event&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ToUserName[0]: &lt;span class=&quot;string&quot;&gt;&quot;阿斯顿&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    xx: &lt;span class=&quot;string&quot;&gt;&quot;xx&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;正好能满足需求&lt;br&gt;使用   &lt;strong&gt;JSON.flatten&lt;/strong&gt; 能还原去扁平化的值，不做演示。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;今天遇到一个问题，多重json嵌套，要扁平化，弱鸡挣扎了下，找了个解决方案&quot;&gt;&lt;a href=&quot;#今天遇到一个问题，多重json嵌套，要扁平化，弱鸡挣扎了下，找了个解决方案&quot; class=&quot;headerlink&quot; title=&quot;今天遇到一个问题，多重json嵌套，
    
    </summary>
    
      <category term="javascript" scheme="http://cqblog.info/categories/javascript/"/>
    
    
      <category term="json" scheme="http://cqblog.info/tags/json/"/>
    
  </entry>
  
</feed>
